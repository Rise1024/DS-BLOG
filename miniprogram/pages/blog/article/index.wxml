<view class="article-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <text class="error-icon">âš ï¸</text>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="loadArticle">é‡è¯•</button>
  </view>

  <!-- æ–‡ç« å†…å®¹ -->
  <view wx:else class="article-content">
    <!-- æ–‡ç« å¤´éƒ¨ -->
    <view class="article-header">
      <text class="article-title">{{article.title}}</text>
      
      <view class="article-meta">
        <text class="article-date">{{article.createdAt}}</text>
        <text class="article-category">{{article.category}}</text>
      </view>
      
      <view wx:if="{{article.tags && article.tags.length}}" class="article-tags">
        <text 
          wx:for="{{article.tags}}" 
          wx:key="*this"
          class="article-tag"
        >
          {{item}}
        </text>
      </view>
    </view>

    <!-- æ–‡ç« æ­£æ–‡ -->
    <view class="article-body">
      <towxml wx:if="{{articleContent && !isContentLoading}}" nodes="{{articleContent}}" />
      <view wx:elif="{{isContentLoading}}" class="content-loading">
        <text>å†…å®¹åŠ è½½ä¸­...</text>
      </view>
      <view wx:else class="no-content">
        <text>å†…å®¹åŠ è½½ä¸­...</text>
      </view>
    </view>

    <!-- ç›¸å…³é¢˜ç›® -->
    <view wx:if="{{article.related_questions && article.related_questions.length > 0}}" class="related-questions">
      <view class="section-title">ç›¸å…³é¢˜ç›®</view>
      <view class="questions-list">
        <view 
          wx:for="{{article.related_questions}}" 
          wx:key="id"
          class="question-card"
          bindtap="goToQuestion"
          data-id="{{item.id}}"
        >
          <view class="question-card-header">
            <text class="question-type">{{item.type === 'short_answer' ? 'ç®€ç­”é¢˜' : 'ç¼–ç¨‹é¢˜'}}</text>
            <text class="difficulty">{{item.difficulty}}â­</text>
          </view>
          <view class="question-card-title">{{item.title}}</view>
          <view class="question-card-tags">
            <text wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag" class="tag">{{tag}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ–‡ç« åº•éƒ¨ -->
    <view class="article-footer">
      <button class="back-btn" bindtap="goBack">
        <text class="back-icon">â†</text>
        <text>è¿”å›åˆ—è¡¨</text>
      </button>
    </view>
  </view>

  <!-- å¤§çº²æŒ‰é’® -->
  <view wx:if="{{article.headings && article.headings.length > 0}}" class="outline-btn" bindtap="toggleOutline">
    <text class="outline-icon">ğŸ“‹</text>
    <text class="outline-text">å¤§çº²</text>
  </view>

  <!-- å¤§çº²æŠ½å±‰ -->
  <view wx:if="{{showOutline}}" class="outline-overlay" bindtap="closeOutline">
    <view class="outline-drawer" catchtap="">
      <!-- æŠ½å±‰å¤´éƒ¨ -->
      <view class="outline-header">
        <text class="outline-title">æ–‡ç« å¤§çº²</text>
        <text class="outline-close" bindtap="closeOutline">âœ•</text>
      </view>
      
      <!-- å¤§çº²åˆ—è¡¨ -->
      <scroll-view class="outline-content" scroll-y="true">
        <view 
          wx:for="{{article.headings}}" 
          wx:key="anchor"
          class="outline-item level-{{item.level}} {{currentHeading === item.anchor ? 'active' : ''}}"
          data-anchor="{{item.anchor}}"
          data-title="{{item.title}}"
          bindtap="scrollToHeading"
        >
          <text class="outline-item-text">{{item.title}}</text>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
