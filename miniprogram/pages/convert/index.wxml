<view class="container">
  <view class="editor-section">
    <!-- 添加进度条组件 -->
    <view class="progress-layer" wx:if="{{showProgress}}">
      <view class="progress-content">
        <view class="progress-text">{{progress}}%</view>
        <view class="progress-bar">
          <view class="progress-inner" style="width: {{progress}}%"></view>
        </view>
      </view>
    </view>

    <textarea
      class="markdown-editor"
      placeholder="请输入Markdown内容"
      bindinput="handleInput"
      value="{{markdownContent}}"
      maxlength="-1"
    ></textarea>

    <view class="style-selector">
      <text class="style-title">选择样式</text>
      <radio-group class="style-options" bindchange="handleStyleChange">
        <label class="style-option" wx:for="{{stylePresets}}" wx:key="id">
          <radio value="{{item.id}}" checked="{{selectedStyle === item.id}}"/>
          <text>{{item.name}}</text>
        </label>
      </radio-group>
    </view>

    <view class="watermark-section">
      <view class="watermark-header">
        <checkbox value="{{enableWatermark}}" bindtap="toggleWatermark" checked="{{enableWatermark}}"/>
        <text class="watermark-title">启用自定义水印</text>
      </view>
      <view class="watermark-input" wx:if="{{enableWatermark}}">
        <input
          class="watermark-text"
          placeholder="请输入水印文字"
          bindinput="handleWatermarkInput"
          value="{{watermarkText}}"
        />
      </view>
    </view>

    <view class="button-group">
      <button 
        class="preview-btn" 
        bindtap="updatePreview"
        loading="{{isPreviewing}}"
        disabled="{{isConverting || !markdownContent}}"
      >预览样式</button>
      <button 
        class="convert-btn" 
        bindtap="convertToImages"
        loading="{{isConverting}}"
        disabled="{{isConverting || !markdownContent}}"
      >生成图片</button>
    </view>

    <!-- 添加样式预览区域 -->
    <view class="style-preview" wx:if="{{previewImage && !previewImages.length}}">
      <text class="preview-title">样式预览</text>
      <image class="preview-image" src="{{previewImage}}" mode="widthFix"/>
    </view>

    <!-- 生成的图片列表 -->
    <view class="preview-section" wx:if="{{previewImages.length > 0}}">
      <text class="preview-title">生成的图片</text>
      <view class="image-list">
        <view class="image-item" wx:for="{{previewImages}}" wx:key="*this">
          <image
            src="{{item}}"
            mode="widthFix"
            class="preview-image"
            data-src="{{item}}"
            bindtap="previewImage"
          />
          <button 
            class="save-btn" 
            data-src="{{item}}" 
            bindtap="downloadImage"
            size="mini"
          >保存</button>
        </view>
      </view>
      <button 
        class="save-all-btn" 
        bindtap="downloadAllImages"
        loading="{{isSavingAll}}"
        disabled="{{isSavingAll}}"
      >保存全部图片</button>
    </view>
  </view>
</view>